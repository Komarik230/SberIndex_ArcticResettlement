<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Почему люди уезжают из Арктики?</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>

<body>

  <!-- СЕВЕРНОЕ СИЯНИЕ -->
  <canvas id="auroraCanvas"></canvas>

  <!-- ЛЕГЕНДА -->
  <img id="legend" src="/static/Group1.svg" alt="Легенда">

  <!-- КАРТА -->
  <object id="map" type="image/svg+xml" data="/static/Карта_1_pora_data-dataframe.svg"></object>

  <!-- ТЕКСТ -->
  <div class="info-text">
    В некоторых местах запятая поставлена иначе.<br>
    Люди уезжают.<br><br>

    Становится меньше света,<br>
    меньше голосов,<br>
    меньше детей в школах.
  </div>

  <!-- СКРИПТЫ -->
  <script src="/static/script.js"></script>

  <!-- СЕВЕРНОЕ СИЯНИЕ — ТЕМНЕЕ, КАК ТЫ ПРОСИЛ -->
  <script>
    const canvas = document.getElementById("auroraCanvas");
    const ctx = canvas.getContext("2d");

    function resize() {
      canvas.width = innerWidth;
      canvas.height = innerHeight;
    }
    resize();
    window.addEventListener("resize", resize);

    let t = 0;
    let mouseX = 0, mouseY = 0;

    window.addEventListener("mousemove", e => {
      mouseX = e.clientX / innerWidth;
      mouseY = e.clientY / innerHeight;
    });

    const clouds = [
      { color: "rgba(120,180,255,0.18)", size: 450 },
      { color: "rgba(80,140,220,0.22)", size: 520 },
      { color: "rgba(60,120,200,0.18)", size: 580 },
      { color: "rgba(150,110,255,0.14)", size: 500 }
    ];

    function drawAurora() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ТЕМНЫЙ ФОН КАК НА ПРАВОМ СЦЕНАРИИ
      let bg = ctx.createLinearGradient(0, 0, 0, canvas.height);
      bg.addColorStop(0, "#322C55");
      bg.addColorStop(1, "#241F3D");
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      clouds.forEach((c, i) => {
        const x = canvas.width * (0.35 + 0.35 * Math.sin(t / (260 + i * 40)) + (mouseX - 0.5) * 0.2);
        const y = canvas.height * (0.42 + 0.28 * Math.cos(t / (280 + i * 50)) + (mouseY - 0.5) * 0.2);
        const r = c.size + Math.sin(t / (90 + i * 25)) * 35;

        const g = ctx.createRadialGradient(x, y, 0, x, y, r);
        g.addColorStop(0, c.color);
        g.addColorStop(1, "transparent");

        ctx.globalCompositeOperation = "lighter";
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2);
        ctx.fill();
      });

      ctx.globalCompositeOperation = "source-over";
      t++;
      requestAnimationFrame(drawAurora);
    }

    drawAurora();
  </script>

  <!-- ПОВЕДЕНИЕ ЛЕГЕНДЫ (ИСКАЗАНИЕ ПРИ СКРОЛЛЕ) -->
  <script>
    const legend = document.getElementById("legend");
    let lastScroll = 0;

    window.addEventListener("scroll", () => {
      const current = scrollY;

      if (current > lastScroll + 20) {
        legend.classList.add("hidden");
      }
      else if (current < lastScroll - 20) {
        legend.classList.remove("hidden");
      }

      lastScroll = current;
    });
  </script>

</body>
</html>
